# 零件:I2C 数字温度计(TC74)

> 原文：<https://hackaday.com/2009/01/02/parts-i2c-digital-thermometer-tc74/>

![tc74](img/b63a4e1564c54f4ace617ad871519200.png "tc74")

微芯片的 TC74 是一种廉价的数字温度传感器，带有简单的 I2C 接口。它的分辨率为 1 摄氏度，范围为-40 至+125 度。这是在没有[模数转换器](http://en.wikipedia.org/wiki/Analog-to-digital_converter)的情况下向项目添加温度测量的简单方法。下面我们将向您展示如何使用 TC74。

**Microchip TC74 数字温度传感器( [Octopart 搜索](http://octopart.com/search?q=microchip+tc74a&s=avail_desc)，起价 0.88 美元)**

TC74 采用五引脚通孔和表面贴装封装，参见 [TC74 数据表](http://ww1.microchip.com/downloads/en/DeviceDoc/21462c.pdf) (PDF)。我们找不到该零件任何版本的 [Cadsoft Eagle](http://www.cadsoft.de) 足迹，如果你知道一个，请在评论中链接到它。

![tc74](img/cf581ef2c272b2340fe3eadeec4c4299.png "tc74")

不同版本的 TC74 针对特定电压进行了校准，但所有版本都在 2.7-5 伏范围内工作。我们使用的 TC74A5 在 5v 下工作时最精确，但我们使用 3.3v 电源供电。I2C 连接需要 2 个[上拉电阻](http://en.wikipedia.org/wiki/Pull-up_resistor)来保持总线高电平(R1，R2)，2K-10K 应该可以工作。C1 是一个 0.1uF 去耦电容。

我们在 I2C 模式下使用了[总线盗版通用串行接口](http://hackaday.com/2008/11/19/how-to-the-bus-pirate-universal-serial-interface/)来测试驱动 TC74，但是相同的原理适用于任何微控制器。我们从 Bus Pirate 的 3.3 伏电源为 TC74 供电，并使用板载上拉电阻来保持 I2C 总线的高电平。

| **命令** | **值** |
| 选择温度寄存器 | 0x00 |
| 选择配置寄存器 | 0x01 |

TC74 的写地址是 0x9a，读地址是 0x9b。它有两个单字节寄存器。寄存器地址 0 保存温度读数，寄存器 1 保存配置设置。

**配置寄存器**

上电时，配置寄存器的位 6 为 0，当第一个有效温度读数可用时，位 6 变为 1。位 7 是可写的，将 TC74 置于省电待机模式。读取寄存器包括两个步骤:使用部分写命令选择寄存器，然后使用读命令检索值。

> I2C>{0x9a 1}
> 210 I2C 开始条件
> 220 I2C 写:0x9a 得到 ACK:是**<–写地址**
> 220 I2C 写:0x01 得到 ACK:是**<–选择配置寄存器**
> 240 I2C 停止条件

首先，我们用部分写命令选择配置寄存器。这实际上并不写值，而是选择寄存器进行读写。{创建 I2C 起始条件，后跟 TC74 写地址(0x9a)和选择配置寄存器命令(0x01)。}发出 I2C 停止条件并结束交易。

现在我们可以读取寄存器的内容了。

> I2C>{0x9b r}
> 210 I2C 开始条件
> 220 I2C 写:0x9b 得到 ACK:是**<–读地址**
> 230 I2C 读:0x 40**<–寄存器值(01000000)**
> 240 I2C 停止条件
> I2C >

读取地址(0x9b)返回一个字节的寄存器值(r)。配置寄存器值 0x40 或 01000000 表示器件退出待机状态(位 7=0)，并且有有效的温度读数可用(位 6=1)。

TC74 具有低功耗待机模式。通过向配置寄存器的位 7 写入 1 来使能它。

> I2C > { 0x9a 1 0b 10000000 }
> 210 I2C 起始条件
> 220 I2C 写:0x9A 得到 ACK:是**<–写地址**
> 220 I2C 写:0x01 得到 ACK:是**<–选择配置寄存器**
> 220 I2C 写:0x80 得到 ACK:是**<–值写(01000000)**
> 240 I2C

该寄存器用单个三字节命令写入。首先发送写地址(0x9a)，然后是要选择的寄存器(0x01)，最后是要写入的值(0x80)。只有配置寄存器的位 7 是可写的，位 6-0 的值被忽略。

再次读取寄存器，验证命令是否有效。

> I2C>{0x9a 1}{0x9b r}
> 210 I2C 起始条件**<—第一个命令集寄存器**
> 220 I2C 写:0x9a 得到 ACK:是**<—写地址**
> 220 I2C 写:0x01 得到 ACK:是**<—配置寄存器(1)**
> 240 I2C 停止条件**<–结束第一个命令**
> 210 I2C 开始条件**<–开始第二个命令**
> 220 I2C 写:0x9B 得到 ACK:是**<–读地址**
> 230 I2C 读:0x 80**<–寄存器值(10000000)**
> 240 I2C 停止条件【240

寄存器值 10000000 现在显示器件处于待机状态(位 7=1)。请注意，位 6 现在为 0，没有可用的温度数据。

将位 7 清零以退出待机状态，然后等待位 6 返回 1，再读取温度寄存器。

> I2C > { 0x9a 1 0b 00000000 }
> 210 I2C 起始条件
> 220 I2C 写:0x9A 得到 ACK:是**<–写地址**
> 220 I2C 写:0x01 得到 ACK:是**<–选择配置寄存器**
> 220 I2C 写:0x00 得到 ACK:是**<–值写(00000000)**
> 240 I2C 停

当配置寄存器值返回 0x40 (01000000)时，温度数据就绪。

**温度**

温度寄存器分两步读取。首先，部分写命令选择温度寄存器(0)，然后读序列返回内容。

> I2C>{0x9a 0}{0x9b r}
> 210 I2C 起始条件
> 220 I2C 写:0x9a 得到 ACK:是**<–写地址**
> 220 I2C 写:0x00 得到 ACK:是**<–选择温度寄存器**
> 240 I2C 停止条件
> 210 I2C 起始条件
> 220 I2C 写:0x9b 得到 ACK:是**<–读地址**

温度是摄氏度的整数值，负数表示为二进制补码。从 0 到 127 摄氏度的正值仅由该值表示。负温度设置了位 7，范围为-1 至-65 (255-128)，参见数据手册第 8 页的表 4.4。十六进制值 0x18 等于十进制的 24，所以温度读数是 24C ( [75F](http://www.google.com/search?q=24c+to+f) )。

喜欢这个帖子？查看您可能错过的[部分帖子](http://hackaday.com/category/parts/)。