# 零件:I2C 音量电位器(DS1807)

> 原文:[https://hack aday . com/2009/02/16/parts-I2C-audio-volume-potentiometer-ds 1807/](https://hackaday.com/2009/02/16/parts-i2c-audio-volume-potentiometer-ds1807/)

![ds1807ii](../Images/0e74ff8eee1557a3e5ed4d63c9e1ed56.png "ds1807ii")

[DS1807](http://www.maxim-ic.com/quick_view2.cfm/qv_pk/2782) 包含两个对数[数字电位器](http://en.wikipedia.org/wiki/Digitally_controlled_potentiometer) (pots)用于音量调节。每个锅有 64 个音量级别加上一个静音设置。每个锅的音量通过双线 [I2C](http://en.wikipedia.org/wiki/I2c) 串行接口设置。下面我们将向您展示如何连接和接口 DS1807。

**DS1807 I2C 音量电位器(Digikey # [DS1807+-ND](http://search.digikey.com/scripts/DkSearch/dksus.dll?Detail&name=DS1807%2B-ND) ，3.04 美元)**

*连接*

| **公交车海盗** | **DS1807 (pin #)** |
| GND | GND (1) |
| GND | A2 (2) |
| GND | A1 (3) |
| GND | A0 (4) |
| GND | AGND (11) |
| 国家药品监督管理局 | 民主行动党(12) |
| 时钟 | SCL (13) |
| +5 伏 | VCC (14) |

我们将 DS1807 连接到 [Bus Pirate 通用串行接口工具](http://hackaday.com/the-bus-pirate-universal-serial-interface/)如表中所示，相同的基本原理适用于任何定制配置。我们使用了 Bus Pirate 的 5 伏电源，但 DS1807 也可以在 3.3 伏下工作。I2C 要求每条信号线上都有一个[上拉电阻](http://en.wikipedia.org/wiki/Pull-up_resistor)，我们使用了 Bus Pirate 的板载电阻连接到板载 5 伏电源。

将 DS1807 连接到数据手册第 3 页所示的音频源。将原始音频信号连接到 H 引脚，将 L 引脚接地，衰减的音频信号将来自 W 引脚。

*接口*

首先，将总线盗版设置为 I2C 模式，并激活 5v 电源。我们在[的最后一篇文章](http://hackaday.com/2009/02/09/parts-ltc2631a-i2c-digital-to-analog-converter/)中介绍了这个过程。

> I2C > v**<–电压监控器**
> 9xx 电压监控器:5V:4.9 | 3.3V:0.0 | VPULLUP:5.0 |
> I2C>

配置好电源后，检查电压监控器(v ),确保 5v 电源有效，上拉电阻上存在 5v 电压。

> I2C >(0)**<–列出可用的宏**
> 0。宏菜单
> 1.7bit 地址搜索
> I2C>(1)**<–运行地址搜索**
> xxx 搜索 7bit I2C 地址空间。
> 在:
> 0x 50 0x 51 0x 52**T16】找到设备–潜在地址**T12】I2C>

总线盗版的地址搜索宏是一种快速定位 I2C 器件的方法，无需查看数据手册。0x50 是 I2C 写地址，因为最后一位是 0，0x51 是读地址(最后一位是 1)。0x52 可能是组/全局写地址，因为它没有相应的读地址。

我们也可以从数据手册中确定地址:基址是 0101 加上三个地址选择位(A0-2，全部接地，000)，写或读位(0 或 1)给出 0b01010000 (0x50)。

> I2C >[0x51 r r]**<–读取 pot 值**
> 210 I2C 起始条件
> 220 I2C 写入:0x 51 得到 ACK:是**<–设备读取地址**
> 230 I2C 读取:0x3F**–pot 0**
> 230 I2C 读取:0x3F**<–pot 1**
> 240 I2C 停止条件
> I2C >

首先，我们在启动时读取电位计值。[发出 I2C 启动条件，0x51 是器件读取地址，“r r”读取两个字节，并]发出 I2C 停止命令。默认启动值为 63 (0x3f)，比静音高一位(数据手册第 2 页)。

> I2C >[0x50 0b 10101001 0]**<–写 pot0**
> 210 I2C 开始条件
> 220 I2C 写:0x 50 得到 ACK:是**<–ds 1807 写地址**
> 220 I2C 写:0xA9 得到 ACK:是**<–pot 0 写命令**
> 220 I2C 写:0x00 得到 ACK:是**<–卷设置 **<–写 pot1**
> 210 I2C 开始条件
> 220 I2C 写:0x50 得到 ACK:是**<–ds 1807 写地址**
> 220 I2C 写:0xAA 得到 ACK:是**<–pot1 写命令**
> 220 I2C 写:0x40 得到 ACK:是**<–卷来设置**
> 240 **<–读回值验证**
> 210 I2C 启动条件
> 220 I2C 写:0x51 得到 ack:是**<–ds 1807 读地址**
> 230 I2C 读:0x 00**<–pot0 值**
> 230 I2C 读:0x 40**<–pot1 值**
> 240 I2C 停止条件**

接下来，我们用单独的命令更新每个卷 pot。0x50 是 DS1807 写地址，0b10101001 (0xA9)是更新 pot0 的命令，0 将卷设置为满。下一个序列使用 update pot1 命令 0b10101010 (0xaa)，并将音量设置为静音(64，0x40)。最后，我们使用 read 过程来验证这些值是否正确。

> I2C >[0x50 0xA9 64 0]**<–写两个 pot 值**
> 210 I2C 起始条件
> 220 I2C 写:0x 50 得到 ACK:是
> 220 I2C 写:0x a9 得到 ACK:是**<–更新 pot0 命令**
> 220 I2C 写:0x40 得到 ACK:是**<–pot 0 值**
> 220 I2C 写:0x00 得到 ACK:是 **<–读回值**
> 210 I2C 开始条件
> 220 I2C 写:0x51 得到 ack:是
> 230 I2C 读:0x 40**<–pot0 值**
> 230 I2C 读:0x 00**<–pot1 值**
> 240 I2C 停止条件
> I2C >

pot 0 write 命令也可用于通过一个命令设置两个电位计值。使用 pot0 更新命令(0b10101001，0xA9)，并在 pot0 值(64)之后发送 pot1 值(0)。

> I2C >[0x50 0b 10101111 0x20]**<–用相同的值更新两个 pot**
> 210 I2C 开始条件
> 220 I2C 写:0x 50 得到 ACK:是
> 220 I2C 写:0xAF 得到 ACK:是**<–双更新命令**
> 220 I2C 写:0x 20 得到 ACK:是**<–值设置**
> 240 I2C 停止 **<–读回值**
> 210 I2C 开始条件
> 220 I2C 写:0x51 得到 ack:是
> 230 I2C 读:0x 20**<–pot 0 值**
> 230 I2C 读:0x 20**<–pot 1 值**
> 240 I2C 停止条件
> I2C >

最后，0xAF (0b10101111)可以用来用相同的值更新两个电位计。对于立体声音量控制来说，这可能是最有用的命令，因为两个声道具有相同的值并同时改变。

在未来的[部分](http://hackaday.com/category/parts/)帖子中，你有没有希望我们涉及的芯片或组件？